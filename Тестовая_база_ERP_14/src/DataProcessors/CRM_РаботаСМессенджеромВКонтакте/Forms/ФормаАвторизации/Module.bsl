
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Параметры.Свойство("АвторизацияПользователя", АвторизацияПользователя);
	Параметры.Свойство("IDГруппы", IDГруппы);
	ПутьКСтраницеАвторизации = Параметры.ПутьКСтраницеАвторизации;
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	Элементы.ТекстЗапроса.Видимость = Истина;
	Элементы.ТекстЗапроса.Документ.URL = ПутьКСтраницеАвторизации;
	ПодключитьОбработчикОжидания("ТекстЗапросаДокументСформирован", 0.1, Истина);
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаКлиенте
Процедура ТекстЗапросаДокументСформирован()
	Ресурс = Элементы.ТекстЗапроса.Документ.URL;
	СтрокаНачалаТокена = ?(АвторизацияПользователя, "access_token=", "access_token_"+IDГруппы+"=");
	Позиция = СтрНайти(Ресурс, СтрокаНачалаТокена);
	Если Позиция>0 Тогда
		Элементы.ТекстЗапроса.Видимость = Ложь;
		МаркерДоступа = Сред(Ресурс, Позиция+СтрДлина(СтрокаНачалаТокена),  СтрНайти(Ресурс, "&expires_in=")-(Позиция+13));
		Закрыть(Новый Структура("Токен", МаркерДоступа));
	КонецЕсли;
	ПодключитьОбработчикОжидания("ТекстЗапросаДокументСформирован", 0.1, Истина);
КонецПроцедуры

#КонецОбласти

