Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Если Статус = Перечисления.АГ_СтатусыЗаявок.Согласован И ТипОперации = Перечисления.АГ_ТипыОперацийЗаявок.Создание Тогда
		Если СоздаватьНоменклатуру Тогда
			Дубль = Документы.АГ_ЗаявкаНаСозданиеИзменениеНовогоЭлементаНоменклатуры.ПроверитьНаДублированиеНоменклатуру(Наименование);
			Если ТипЗнч(Дубль) = Тип("СправочникСсылка.Номенклатура") Тогда
				Сообщить("В базе существует номенклатура " + Дубль + " с указанными наименованием. Создание невозможно");
				Отказ = Истина;
				Возврат;
			КонецЕсли;
			НомОбъект = Справочники.Номенклатура.СоздатьЭлемент();
			ЗаполнитьЗначенияСвойств(НомОбъект, ЭтотОбъект, "ВидНоменклатуры");
			Справочники.Номенклатура.ЗаполнитьРеквизитыПоВидуНоменклатуры(НомОбъект);
			ЗаполнитьЗначенияСвойств(НомОбъект, ЭтотОбъект,,"ВидНоменклатуры");
			НомОбъект.Качество = Перечисления.ГрадацииКачества.Новый;
			НомОбъект.ДополнительныеРеквизиты.Загрузить(ДополнительныеРеквизиты.Выгрузить());
			Справочники.Номенклатура.ЗаполнитьРеквизитыПоВидуНоменклатуры(НомОбъект);
			НомОбъект.Записать();
		КонецЕсли;
		Если СоздаватьХарактеристику Тогда
			Если Не СоздаватьНоменклатуру Тогда
				Дубль = Документы.АГ_ЗаявкаНаСозданиеИзменениеНовогоЭлементаНоменклатуры.ПроверитьНаДублированиеХарактеристику(НаименованиеХарактеристики, СуществующаяНоменклатура);
				Если ТипЗнч(Дубль) = Тип("СправочникСсылка.ХарактеристикиНоменклатуры") Тогда
					Сообщить("В базе существует характеристика " + Дубль + " с указанными наименованием. Создание невозможно");
					Отказ = Истина;
					Возврат;
				КонецЕсли;
				Владелец = СуществующаяНоменклатура;
			Иначе
				Владелец = НомОбъект.Ссылка;
			КонецЕсли;
			ХарОбъект = Справочники.ХарактеристикиНоменклатуры.СоздатьЭлемент();
			ХарОбъект.Владелец = Владелец;
			ХарОбъект.Наименование = НаименованиеХарактеристики;
			ХарОбъект.НаименованиеПолное = НаименованиеПолноеХарактеристики;
			ХарОбъект.ДополнительныеРеквизиты.Загрузить(РеквизитыХарактеристик.Выгрузить());
			ХарОбъект.Записать();
		КонецЕсли;
	КонецЕсли;

КонецПроцедуры

Процедура ПриКопировании(ОбъектКопирования)
	ЕстьДубли = Истина;
	Статус = Перечисления.АГ_СтатусыЗаявок.ПодготовкаКПодачеЗаявки;
КонецПроцедуры

Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)
	Если СоздаватьНоменклатуру Тогда
		ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("СуществующаяНоменклатура"));
		
		Если Не ПлощадьИспользовать Тогда
			ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("ПлощадьЗнаменатель"));
			ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("ПлощадьЧислитель"));
		КонецЕсли;
		Если Не ОбъемИспользовать Тогда
			ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("ОбъемЗнаменатель"));
			ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("ОбъемЧислитель"));
		КонецЕсли;
		Если Не ДлинаИспользовать Тогда
			ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("ДлинаЗнаменатель"));
			ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("ДлинаЧислитель"));
		КонецЕсли;
	    Если Не ВесИспользовать Тогда
			ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("ВесЗнаменатель"));
			ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("ВесЧислитель"));
		КонецЕсли;
		Если Не СоздаватьХарактеристику Тогда
			ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("НаименованиеХарактеристики"));	
		КонецЕсли;
	ИначеЕсли СоздаватьХарактеристику Тогда
		ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("Наименование"));
		ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("ЕдиницаИзмерения"));
		ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("СтавкаНДС"));
		ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("КодТНВЭД"));
		ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("ПлощадьЗнаменатель"));
		ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("ПлощадьЧислитель"));
		ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("ОбъемЗнаменатель"));
		ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("ОбъемЧислитель"));
		ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("ДлинаЗнаменатель"));
		ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("ДлинаЧислитель"));
		ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("ВесЗнаменатель"));
		ПроверяемыеРеквизиты.Удалить(ПроверяемыеРеквизиты.Найти("ВесЧислитель"));	
	КонецЕсли;

КонецПроцедуры

