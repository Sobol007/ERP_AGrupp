
&НаКлиенте
Процедура Выбрать(Команда)
	
	Структура = Новый Структура;
	Структура.Вставить("Имя",Наименование);
	Структура.Вставить("Заголовок", Наименование);
	Структура.Вставить("НаборСвойств",ПредопределенноеЗначение("Справочник.НаборыДополнительныхРеквизитовИСведений.Документ_CRM_Заявка"));
	Структура.Вставить("ТипЗначения", ПолучитьТипЗначения());
	Структура.Вставить("Доступен",Истина);
	Структура.Вставить("Виден",Истина);
	Структура.Вставить("ЗаполнятьОбязательно",Обязательно);
	
	СсылкаРеквизит = СозданиеПВХ(Структура);
	
	Если ТипЗначения = "4" И НЕ ДополнительныеЗначения.Количество() = 0 Тогда
		
		СозданиеДополнительныхДанныхДляДопРеквизита();
		
	КонецЕсли;
	
	ОповеститьОВыборе(СсылкаРеквизит);
	
КонецПроцедуры

&НаСервере
Процедура СозданиеДополнительныхДанныхДляДопРеквизита()
	
	Для Каждого Стр Из ДополнительныеЗначения Цикл
		
		СпрОбъект = Справочники.ЗначенияСвойствОбъектов.СоздатьЭлемент();
		СпрОбъект.Владелец = СсылкаРеквизит;
		СпрОбъект.Наименование = Стр.ЗначениеДоп;
		
		Попытка
			СпрОбъект.Записать();
		Исключение
			
		КонецПопытки;
		
	КонецЦикла;
	
КонецПроцедуры
	
&НаКлиенте
Функция ПолучитьТипЗначения()
	
	Массив = Новый Массив;
	Если ТипЗначения = "0" Тогда
		Возврат Новый ОписаниеТипов("Строка",,,,Новый КвалификаторыСтроки("20"));
	ИначеЕсли ТипЗначения = "1" Тогда
		Возврат Новый ОписаниеТипов("Число",,,,Новый КвалификаторыЧисла(10,2));
	ИначеЕсли ТипЗначения = "2" Тогда
		Массив.Добавить(Тип("Булево"));
		Возврат Новый ОписаниеТипов(Массив);
	ИначеЕсли ТипЗначения = "3" Тогда
		Возврат Новый ОписаниеТипов("Дата",,,,Новый КвалификаторыДаты(ЧастиДаты.Дата));
	//ИначеЕсли ТипЗначения = "4" Тогда
	//	Возврат Новый ОписаниеТипов("();

		
	КонецЕсли;	
	
КонецФункции

&НаСервере
Процедура СозданиеПВХНаСервере(НовыйОбъектПВХ,Структура)
	
	ЗаполнитьЗначенияСвойств(НовыйОбъектПВХ,Структура);
	
	НаименованиеНабора = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(НовыйОбъектПВХ.НаборСвойств, "Наименование");
	НовоеНаименование = НовыйОбъектПВХ.Заголовок + " (" + НаименованиеНабора + ")";
	НовыйОбъектПВХ.Наименование = НовоеНаименование;
	
КонецПроцедуры

&НаКлиенте
Функция СозданиеПВХ(Структура)
	
	ФормаПВХ = ПолучитьФорму("ПланВидовХарактеристик.ДополнительныеРеквизитыИСведения.ФормаОбъекта");
	ДанныеФормы = ФормаПВХ.Объект;
	СозданиеПВХНаСервере(ДанныеФормы,Структура);
	КопироватьДанныеФормы(ДанныеФормы, ФормаПВХ.Объект);
	ФормаПВХ.Записать();
	
	Возврат ФормаПВХ.Объект.Ссылка;
	
КонецФункции

&НаКлиенте
Процедура ТипЗначенияПриИзменении(Элемент)
	
	Если ТипЗначения = "4" Тогда
		Элементы.ДополнительныеЗначения.Видимость = Истина;
	Иначе
		Элементы.ДополнительныеЗначения.Видимость = Ложь;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура Отменить(Команда)
	
	ЭтотОбъект.закрыть();
	
КонецПроцедуры
