#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область СлужебныеПроцедурыИФункции

Функция ПараметрыНастройки(ПараметрНастройкиСсылка) Экспорт

	СтруктураРеквизитов = Новый Структура;
	СтруктураРеквизитов.Вставить("ПравилоРасчетаПроцентаВыполненияЗадач");
	
	Используемые = ПараметрНастройкиСсылка.ИспользуемыеОбъекты.НайтиСтроки(Новый Структура("Использовать", Истина));
	ИспользуемыеОбъекты = Новый Соответствие;
	Для каждого Строка из Используемые Цикл
		ИспользуемыеОбъекты.Вставить(Строка.ТипПредмета, Строка.ВариантЗаполнения);
	КонецЦикла;
	СтруктураРеквизитов.Вставить("ИспользуемыеОбъекты", ИспользуемыеОбъекты);
	
	Возврат СтруктураРеквизитов;
	
КонецФункции // ПараметрыНастройки()

Функция ДоступныеСценарииПоТипуИспользуемыхОбъектов(ТипПредмета, ВариантЗаполнения = Неопределено) Экспорт
	
	Запрос = Новый Запрос("ВЫБРАТЬ
	                      |	CRM_СценарииВыполненияПорученийИспользуемыеОбъекты.Ссылка КАК Ссылка
	                      |ИЗ
	                      |	Справочник.CRM_СценарииВыполненияПоручений.ИспользуемыеОбъекты КАК CRM_СценарииВыполненияПорученийИспользуемыеОбъекты
	                      |ГДЕ
	                      |	CRM_СценарииВыполненияПорученийИспользуемыеОбъекты.ТипПредмета = &ТипПредмета
	                      |	И CRM_СценарииВыполненияПорученийИспользуемыеОбъекты.Использовать");
	
	Запрос.УстановитьПараметр("ТипПредмета", ТипПредмета);
	Если ЗначениеЗаполнено(ВариантЗаполнения) Тогда
		Запрос.УстановитьПараметр("ВариантЗаполнения", ВариантЗаполнения);
		Запрос.Текст = Запрос.Текст + "
		|	И CRM_СценарииВыполненияПорученийИспользуемыеОбъекты.ВариантЗаполнения = &ВариантЗаполнения";
	КонецЕсли;
	
	Результат = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Ссылка");
	
	Возврат Результат;
	
КонецФункции

#КонецОбласти

#КонецЕсли